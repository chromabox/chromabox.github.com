<!--?xml version="1.0" encoding="UTF-8"?-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html
  xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
  <head>
    <meta http-equiv="content-language" content="ja">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="start index" href="./">
    <title>GT-I9100 公式カーネルのコンパイル方法</title>
  </head>
  <body>
    <h2>GT-I9100 公式カーネルのコンパイル方法</h2>
    <p> 内容は無保証。<br>
      わかる人だけ参考にしてください。<br>
      <br>
      はなくろ様の<a href="http://blog.8796.jp/8796kanri/2011/05/%e9%9b%bb%e8%a9%b1-galaxy-sii-gt-i9100%e3%81%ae%e3%82%ab%e3%83%bc%e3%83%8d%e3%83%ab%e3%82%92%e6%89%8b%e6%97%a9%e3%81%8f%e3%83%93%e3%83%ab%e3%83%89%e3%81%99%e3%82%8b.html">ページ</a>を参考にしております。 <br>
    </p>
    <p><br>
    </p>
    <hr checked="true">
    <h4>前提．</h4>
    <p>make とかLinuxホスト側のgccとかその辺は予め入れておくこと。<br>
      カーネルのコンパイルはAndroidのビルドみたいに廃スペックは要求されないので、VirtualBoxなどの仮想環境にUbuntuなどに構築してビルドで余裕。<br>
      日本版は最後にカーネルイメージをLZOで圧縮するのでlzopとか入れておくのを忘れずに。<br>
    </p>
    <hr checked="true">
    <h4>１．カーネルをさむすんさまから落とす</h4>
    <a href="https://opensource.samsung.com/">https://opensource.samsung.com/</a>
    から落とす。<br>
    <br>
    GT-I9100で検索。たまにこっそり更新されてるので注意。 <br>
    <br>
    <hr checked="true">
    <h4>２．落としたカーネルソースともども展開する </h4>
    <hr checked="true">
    <h4>３．コンパイラをどこかに展開。</h4>
    コンパイラはARMのGCCで4.3以上ならとりあえず良いらしいけど、最初はREADMEの通りCode Sourcery G++ Lite 2009q3-68 for ARM EABIを使う <br>
    <a href="http://www.codesourcery.com/sgpp/lite/arm/portal/release1033">http://www.codesourcery.com/sgpp/lite/arm/portal/release1033</a>
    <br>
    <br>
    <hr checked="true">
    <h4>４．moduleをインストールする受け皿ディレクトリを作る </h4>
    <hr checked="true">
    <h4>５．パス通すためのなんか適当なシェルスクリプトをこんな感じで作る </h4>
    <br>
    <code>$ touch env.sh<br>
      $ vi env.sh <br>
    </code><br>
    などとして作るべし。 <br>
    <br>
    参考例：<br>
    <br>
    <code>#!/bin/bash <br>
      <br>
      export PATH=/opt/android/sgs2/toolchains/arm-2009q3/bin:$PATH <br>
      export ARCH=arm <br>
      export CROSS_COMPILE=arm-none-eabi- <br>
      export INSTALL_MOD_PATH=/opt/android/sgs2/fstemp <br>
      <br>
      echo "Set Samsung GalaxyS II (GT-I9100) arm-none-eabi-gcc ver
      4.4.1 with Linux 2.6.35" </code><br>
    <br>
    (LOCALVERSIONとか、KBUILD_BUILD_VERSIONはお好みでexportすればよろし)<br>
    <br>
    作ったらこういう感じで環境をセットする <br>
    <br>
    <code>$ chmod +x env.sh <br>
      $ . ./env.sh </code><br>
    <br>
    <hr checked="true">
    <h4>６．カーネルのディレクトリに行ってから </h4>
    <br>
    <code>$ make c1_rev02_jpn_ntt_defconfig <br>
      $ make <br>
      $ make modules <br>
      $ make modules_install </code><br>
    <br>
    (日本版はc1_rev02_jpn_ntt_defconfigです。他の環境のコンフィグはarch/arm/configsに色々入っているので覗いてみると良いですよ)<br>
    <br>
    でOK。 <br>
    <br>
    arch/arm/boot/にzImageが出来ているのでこれがカーネルの純粋なイメージとなる。<br>
    <br>
    # make -j4 とかまぁその辺は適切に。 <br>
    # make modules は、makeの最後のほうに勝手にやるのでいらんかもしんないけど一応。<br>
    # make modules_installは、受け皿 /opt/android/sgs2/fstemp に.ko（ドライバたち）がコピーされる<br>
    <br>
    <hr checked="true">
    <h4>７．とりあえず何処からかinitramfsの大元をどこからか取得する。</h4>
    このへんの使ったほうがよいかも。（但し、これは国際版。日本版のは色々捏造して作ってみてください。そんなに難しくは無いです）<br>
    <br>
    <a checked="true" href="https://github.com/GalaxySII/initramfs-galaxysii">https://github.com/GalaxySII/initramfs-galaxysii</a>&nbsp;
    ：特になにもいじっていないinitramfs。<br>
    <a href="https://github.com/project-voodoo/galaxysii-initramfs-modified">https://github.com/project-voodoo/galaxysii-initramfs-modified</a>&nbsp;
    ：suとsuperuser.apkが初期にコピーされるようになってる<br>
    &nbsp; <br>
    <hr checked="true">
    <h4>８．initramfsにさっき作ったドライバをコピーする </h4>
    <code>$ cd fstemp<br>
      $ find -name '*.ko' -exec cp -av {} ../initramfs_mod/lib/modules/
      \;</code><br>
    <br>
    <hr checked="true">
    <h4>９．cpioでinitamfsの元を固める</h4>
    <code>$ su <br>
      # cd initramfs_mod <br>
      # find | cpio -H newc -o &gt; ../initramfs_mod.cpio 2&gt;/dev/null
      # exit </code><br>
    <br>
    (fakerootがある場合はsu使わなくてもいい)<br>
    <br>
    <hr checked="true">
    <h4>１０．再びカーネルをコンパイル。 </h4>
    一度コンパイルしたのであとはzImageにくっ付ける作業をするだけ<br>
    <br>
    <code>$ cd kermel <br>
      $ make zImage CONFIG_INITRAMFS_SOURCE="../initramfs_mod.cpio" </code><br>
    <br>
    <hr checked="true">
    <h4>１１．arch/arm/bootにzImageがあるのでTARして終わり</h4>
    <code>$ tar cvf GT-I9100_kernel_Gingerbread_homebrew.tar zImage </code><br>
    <br>
    <hr checked="true"><br>
    ↑の一連操作が面倒な人はこのスクリプト(<a href="build_kernel.sh">build_kernel.sh</a>)
    をつかうとよいかも。<br>
    <br>
    使いかたは次の通り。<br>
    <br>
    前提：<br>
    クロスコンパイラ、カーネル、initramfsの素は取得して適切な場所に展開しておいてください。<br>
    <br>
    注意：<br>
    実行する前に<a href="build_kernel.sh">build_kernel.sh</a>を適時環境に合わせて書き換えてくだ
    さい。<br>
    <br>
    パスやファイル名はフルパスで設定してください。<br>
    <br>
    KCONFIGNAME ： 大元となるカーネルのコンフィグ名。<br>
    TAR_NAME： 最終的に生成されるTAR名<br>
    INITRAMFS_DIR： initramfsの素をコピーしておいたディレクトリ名<br>
    KMODPATH： カーネルモジュールパス。作業用なので適当に<br>
    KERNELPATH： カーネルのパス<br>
    TOOLCHAINPATH： コンパイラ（ツールチェイン）へのパス<br>
    <br>
    以下はお好みで<br>
    <br>
    LOCALVERSION ローカルバージョン名。カーネルバージョンの後ろにくっつきます。<br>
    KBUILD_BUILD_VERSION 同じく<br>
    <br>
    設定しおえたら<br>
    $ ./build_kernel.sh<br>
    として実行。<br>
    すると、<br>
    choose:<br>
    1: default jpn config kernel and build<br>
    2: default jpn config and reconfig kernel and build<br>
    3: reconfig kernel and build<br>
    4: no config kernel and build<br>
    と出てくるので、数字キーを押してリターンしてください。<br>
    <br>
    よくわからんかったら１でOKです。<br>
    <br>
    一応説明すると<br>
    １：デフォルトのJPNコンフィグを使ってカーネルとinitramfsをビルドします。<br>
    ２：デフォルトのJPNコンフィグを使って一度menuconfigでコンフィグ画面を出した後、カーネルとinitramfsをビルドします。<br>
    ３：カーネルディレクトリに残っているコンフィグを使ってmenuconfigでコンフィグ画面を出した後、カーネルとinitramfsをビル
    ドします。<br>
    ４：カーネルディレクトリに残っているコンフィグを使ってカーネルとinitramfsをビルドします。（要はリビルドのみやるやつ。ソースに手を加えた場合に使うと良い）<br>
    <br>
    （一度cleanをしてからビルドするのでcleanが困る人はmake cleanの項目をコメントアウトしてください）<br>
    <br>
    で、うまくいったら最後に<br>
    done.<br>
    と出てきてTARが出来ているはずです。<br>
    <br>
    出来たらおでんで煮込みましょう。<br>
    <br>
    <hr checked="true">
    <h4>余談１．</h4>
    c1_rev02_jpn_ntt_defconfigはデバッグ用オプションが軒並みONになってるので、OFFにすると若干早くなります。<br>
    printkの情報を見て色々デバッグとか探求する用途ならこれでいいわけですが、通常運用には要らないでしょう。<br>
製品版でもOFFになってるそーです。色々いじってみましょう。<br>
    <br>
    <br>
    <h4>余談２．</h4>
    ちゃんとしたinitramfsとカーネルを用意できればワンセグもGPSも問題なく動く「はず」です。他のXXXなXXXだと色々やらかしてくれるんですが、この辺はさむすんえらい。<BR>
    動かないときは貴方が何かをミスっています。<br>
    答えは書きませんが、ヒントだけ示しておきます。<br>
    １．.prop系をミスってる。或いは何かが足りない。<br>
    ２．そもそも日本版のコンフィグでコンパイルできていない。そもそも日本版のカーネルではない。<br>
    ３．デバイスドライバがカーネルと不一致<br>
    （Linuxはモノリジックカーネルなので、そのカーネルをビルドした環境で完全一致したドライバもあわせて作らないといろんなところでコケます）<br>
<br>
    <br>
  </body>
</html>

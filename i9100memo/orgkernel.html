<!--?xml version="1.0" encoding="UTF-8"?-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html
  xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
  <head>
    <meta http-equiv="content-language" content="ja">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="start index" href="./">
    <title>製品版と公開されているカーネルとの違いについて</title>
  </head>
  <body>
    <h2>製品版と公開されているカーネルとの違いについて<br>
    </h2>
    <p> この内容については無保証です。<br>
    <p> 製品版SGS2 (SC-02C)と、公開されているカーネルの違いについてまとめています。<br>
    そもそも、GT-19100は地域によって機能が違うので、当然カーネルが違うことがわかっています。<br>

<div>
<hr checked="true"><span style="font-weight: bold;">[事の発端]</span><br>
<br>
なんとなく出荷時のカーネルに戻してみよう思い立ち元に戻したところ、N033をベースに自分で作ったカーネルよりも少し挙動が違っていたので、「これはもしや公開されているカーネルとは違うのでは。。。」という考えに至って調べたのが発端です。<br>
<br>
<br>
数日間出荷時カーネルを使っていてなんとなく感じたのは次の通り<br>
・画面がやや黄色っぽい<br>
・なんだかオート輝度設定が敏感な感じがする<br>
・充電がどうも遅い感じがする？(勘違いかも)<br>
</div>

<div><br>
<hr checked="true"><span style="font-weight: bold;">[ソースの種類]</span><br>
<BR>
公式に公開されているソースは次の通り。（もっとあるかもしれません）<BR>
<BR>
<code><pre>
I9100 SGH-N033 EUR ：俗に言う国際版
I9100 EUR Update1  ：7月中ごろに出た国際版のアップデート版(カーネルのみ)
I9100 HK CHR       ；香港版。SIMフリーらしい
I9100 CHR CHR      ；中国版。
SHW-M250K          ：韓国版のI9100(KT向け)
SHW-M250K Update1  ：韓国版のI9100(バージョンアップ版。カーネルのみ)
SHW-M250S          ：韓国版のI9100(SKテレコム向け)
SHW-M250S Update1  ：韓国版のI9100(バージョンアップ版。カーネルのみ)
SHW-M250L          ：韓国版のI9100(LG U+向け)
SHW-M250L Update1  ：韓国版のI9100(バージョンアップ版。カーネルのみ)
</pre></code>
</div>

<div><br>
<hr checked="true"><span style="font-weight: bold;">[シンボルの違い]</span><br>
<BR>
当初、日本版SC-02CはビルドバージョンがN033であることから国際版が流用されていると思われていたが実際は色々違う。<BR>
購入時に入っているカーネルを調べると、現在OpenSourceとして公開されている国際版のソースとは違う点が見つかっている<BR>
<BR>
具体的に言うと、出荷時カーネルには<BR>
SEQ_INIT_DISPLAY_SETTING_SM2_A2<BR>
があるのだが、国際版にはこれがなかった。(Update1でようやくCodeが入った)<BR>
<BR>
(SEQ_INIT_DISPLAY_SETTING_SM2_A2はAMOLEDの色テーブル関連の様子なので青っぽかったのはコレが原因)<BR>
</div>

<div><br>
<hr checked="true"><span style="font-weight: bold;">[ソースの違い]</span><br>
<BR>
ざっとみたところ、こんな感じ。<BR>
<BR>
I9100 HK CHR と SHW-M250X Update1は微妙に違うけどかなり近い。<BR>
SHW-M250X とSHW-M250XUpdate1はアップデート版なだけあってソースがそこそこ違う<BR>
SHW-M250X とI9100 SGH-N033では韓国版の変更が多少加わっている。ソースは良く似ている。<BR>
<BR>
SHW-M250KとSは殆ど同じ。SHW-M250KとSのUpdate1でさらに同じになった。<BR>
ただ、やっぱり微妙な違いは存在していて、dev_attr_gyro_power_onなどがKにはあるがSにはない等ある。<BR>
<BR>
SHW-M250LはConfigが微妙に違ったり(LはNFCなしモデル)、GPIOの定義がちょっと違ったりKとSとは微妙に異なる。<BR>
<BR>
I9100 EUR Update1は I9100 HK CHRと大変良く似ている。Sleep.sのTLBの修正など、M250Kから持ってきたやばそうな修正点が幾つか入っているのでHK CHRの修正版と見てもよさそう。<BR>
<BR>
I9100 CHR CHRは後発だが、Sleep.sのTLBの修正がなかったりするので多分そんなには新しくない。<BR>
<BR>
開発の時系列としてはこんな感じかもしれない<BR>
<code><pre>
I9100 SGH-N033 EUR (ベース) ---> SHW-M250x ----------------------> SHW-M250x Update1
                             +-----------> I9100 HK CHR ---------> EUR Update1
                             +------------------> I9100 CHR CHR 
                             +--------------->SC-02C(KF2)-->SC-02C(KG5)
</pre></code>
ソースを見ると日本版とEUR Update1がもっとも良く似ている？？
（M250Kは日本版には無いシンボルが幾つか存在している...）
</div>


<div><br>
<hr checked="true"><span style="font-weight: bold;">[Eur Update1とSC-02C(KF2)との違い]</span><br>
<BR>
EUR Update1とSC-02C製品版カーネルは似ているのだが、やはりそれでも製品版には無いシンボルが幾つか存在している。ので、厳密には完全一致とは言えない。<br>
<BR>
・何処かのソースにはあるもの<BR>
<BR>
watchdog_init<BR>
 CONFIG_WATCHDOGをYにしてもだめだった。(実は c1-watchdogが外されている。韓国版ではMakefileに入っている）<BR>
<BR>
dmb_init_hw_setting<BR>
 drivers/media/isdbt/fc8100/fc8100.c に存在。(SGH-N033にある)<BR>
 (dmb_init_hw_settingとdmb_hw_settingがまったく同じことをしているので削除された模様）<BR>
<BR>
last_uevent_state<BR>
 drivers/media/video/samsung/tvout/s5p_tvout_hpd.c に存在(SGH-N033にある)<BR>
  (Codeを観たところ、多分いらないものだから消されたんだと思われる)<BR>
<BR>
<BR>
・SC02Cにだけあって、どのカーネルにも無いもの(要するに謎の関数・シンボル)<BR>
<BR>
l2x0_nolock_clean_all <BR>
m5mo_set_recording_state<BR>
sec_bat_get_recording_state<BR>
checkfilename_do_truncate<BR>
sdhci_init_card<BR>
<BR>
__param_str_sec_pet <BR>
__param_str_sec_reset <BR>
isRecording<BR>
calculate_average_adc drivers/power/sec_battery.c <BR>
(実はUpdate1などのソースには存在しているものの、Update1ではstatic宣言なので表に出てこない)<BR>
<BR>
</div>

<div><br>
<hr checked="true"><span style="font-weight: bold;">[SC-02C(KF2)とSC-02C(KG5)との違い]</span><br>
2011年8月にアップデートがあり、カーネルはKG5となった。<BR>
<BR>
KF2とKG5の相違点は次の通り。<BR>
シンボルだけを見るとLD9040(LCDがらみ)の変数が若干なくなっている<BR>
<BR>
以下のシンボルがなくなっている。<BR>
<BR>
ld9040_sm2_a1_19_40<BR>
ld9040_sm2_a1_22_40<BR>
ld9040_sm2_a2_19_40<BR>
ld9040_sm2_a2_22_40<BR>
<BR>
あとSEQ_ACL_ONまわりのサイズが増えているかもしれない。<BR>
<BR>
逆アセンブルレベルでは確認していないが、他の変更点は無い模様。<BR>
アドレスと関数の想定サイズだけを見るとLCD関連以外はほぼ一致している。<BR>
<BR>
<BR>
</div>


<div><br>
<hr checked="true"><span style="font-weight: bold;">[実際に焼いてみると]</span><br>
<BR>
Update1版を焼いてみたところ、出荷時のものと良く似た挙動になった（なんか暗かったりするところとか）<BR>
出てくるdmesgもまぁまぁ近い。<BR>
</div>

<div><br>
<hr checked="true"><span style="font-weight: bold;">[コンパイラについて]</span><br>
<BR>
なるべく公式版とあわせようと思ったら、Androidのソースのprebuildに入っているgcc4.4.0を使うほうが良い。<BR>
<BR>
READMEにはCodesoucerlyのものを使うべしと書いてあるが、韓国版には何故かビルドスクリプトが入っており、そこに書いてあるgccへのパスはどうみてもAndroidソースのprebuildのものを使っているため。<BR>
</div>

<div><br>
  <hr checked="true"><span style="font-weight: bold;">[余談]</span><br>
  <br>
  やっぱり公開されているものと違ったんだなぁという感想ですが、別段問題なく動いてはいるのでまぁいっかという心境です。<br>
  純正で動かせるようなドライバを作るときに難儀するかも知れませんが(insmodで蹴られるかもしれません)、root取らない人はそんなもの入れないだろうということで。<br>
  <br>
  <br>
</div>



  </body>
</html>

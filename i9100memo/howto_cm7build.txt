CyanogenMod7ビルド方法

ココを参考にした。
http://www.ekesete.net/log/?p=3668


・ソース取得
$repo init -u git://github.com/CyanogenMod/android.git -b gingerbread
$repo sync -j3
syncは半日くらい掛かったりするので気長に待つこと。

・proprietaryなファイルの取得
$cd device/samsung/galaxys2
$sh extract-file.sh
これで取得できるけど、めんどくさい場合はすでに作成されているZipから取ってくればいいと思う。
(但し、元から有る端末に入っているものと違うので色々動かないかもしれない)

・RomManagerをダウンロード
$cd vender/cyanogen
$./get-rommanager
中でcurlを使ってるので、Proxyが必要な場合は適切に設定すること
(export ALL_PROXY=http://hogehoge:8080 とかで）


・ビルド
$. build/envsetup.sh
$brunch galaxys2
(brunchを使うと途中でschedtoolが無いとか言われるかもしれない) 

うまくビルドが通ったら
out/target/product/galaxys2
にSigned.zipがあるのでこれをRomManagerなどで焼けばOK。


[余談1]
デフォルトで出来るZIPではSC-02Cに入れるときにエラーで弾かれるので
BoardConfig.mkの以下行を次のようにすればよい。

つまり、
TARGET_OTA_ASSERT_DEVICE := galaxys2,GT-I9100,GT-I9100M,GT-I9100T
を
TARGET_OTA_ASSERT_DEVICE := galaxys2,GT-I9100,GT-I9100M,GT-I9100T,SC-02C
にする。

[余談2]
extract-files.shはターゲットから直接とってきて何が足りないとかが良くわからなくなるので、
extract-local.shなんかを作ってローカルからのコピーで済ますと色々差し替えも捗ってよい感じ。

たとえば、この行
adb pull /system/lib/libActionShot.so ../../../vendor/$MANUFACTURER/$COMMON/proprietary/libActionShot.so

を、こうすればいい
cp ../../../../cm7sys/system/lib/libActionShot.so ../../../vendor/$MANUFACTURER/$COMMON/proprietary/libActionShot.so


[余談3]
CM7をCWMで手作業の導入をするときはなんか2回適用しないとうまくかけないことがあった。謎。

